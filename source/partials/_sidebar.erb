<aside class="sidebar">

  <section>
    <h2>Categories</h2>
    <ul>
      <% sitemap.resources.group_by {|p| p.data.category }.each do |category, pages| %>
      <% next if category.to_s == "" %>
      <li><%= link_to(h(category), "/categories.html#" + h(category)) %>
	<ul>
	<% pages.each do |page| %>
	  <% opt = (page.path == current_page.path) ? {disabled: "disabled"}  : {} %>
	  <li><%= link_to(h(page.data.title), page, opt) %>
	<% end %>
	</ul>
      </li>
    <% end %>
    </ul>
  </section>

  <section>
    <h2>Tags</h2>
    <ul class="tag_box inline">
      <% tags.each do |tag, pages| %>
        <% caption = "%{tag} <span>%{count}</span>" % {tag: h(tag), count: pages.count} %>
        <li><%= link_to(caption, "/tags.html#" + h(tag)) %></li>
      <% end %>
    </ul>
  </section>
  
  <section>
    <h2>Series</h2>
    <ul>
      <% sitemap.resources.group_by {|p| p.data.series }.each do |series, pages| %>
      <% next if series.to_s == "" %>
      
      <li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= h(series) %></a>
	<ol class="dropdown-menu">
	  <% i = 1 %>
	  <% pages.sort {|a, b| a.url <=> b.url }.each do |page| %>
	  <li><%= link_to(i.to_s + ": " + h(page.data.title), page, {tabindex: "-1", role: "menuitem"}) %>
	    <% i += 1 %>
	    <% end %>
	</ol>
      </li>
      <% end %>
    </ul>
  </section>

  <section>
    <h2>Recent Updated</h2>
    <ul>
    <% recent_pages.each do |date, pages| %>
      <li><%= date.strftime("%d %b %Y") %>
	<ul>
	  <% pages.each do |page| %>
	  <li><%= link_to(h(page.data.title), page) %></li>
	  <% end %>
	</ul>
    <% end %>
    </ul>
  </section>
</aside>
